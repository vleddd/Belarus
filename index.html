<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>DeepYouMap - –ö–∞—Ä—Ç–∞ —Å —Å–æ–±—ã—Ç–∏—è–º–∏</title>
    <script src="https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.js"></script>
    <script src="https://unpkg.com/@turf/turf@6/turf.min.js"></script>
    <link href="https://unpkg.com/maplibre-gl@2.4.0/dist/maplibre-gl.css" rel="stylesheet">
    <style>
        body { margin:0; padding:0; }
        #map { width:100%; height:100vh; }

        /* –ü–∞–Ω–µ–ª—å –∫–∞–ª–µ–Ω–¥–∞—Ä—è */
        #date-panel {
            position: absolute;
            top: 10px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(255, 255, 255, 0.95);
            padding: 8px 16px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            gap: 15px;
            z-index: 10;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            font-family: Arial, sans-serif;
        }
        .date-button {
            font-size: 20px;
            cursor: pointer;
            background: none;
            border: none;
        }
        #current-date {
            font-size: 16px;
            font-weight: bold;
        }

        /* –ö–æ–ª–æ–∫–æ–ª—å—á–∏–∫ */
        #notifications {
            position: absolute;
            top: 10px;
            left: 10px;
            z-index: 11;
            font-size: 26px;
            cursor: pointer;
        }
        #notifications-panel {
            position: absolute;
            top: 50px;
            left: 10px;
            width: 300px;
            max-height: 400px;
            overflow-y: auto;
            background: rgba(255, 255, 255, 0.95);
            padding: 10px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            font-family: Arial, sans-serif;
            display: none;
            flex-direction: column;
            gap: 8px;
        }
        .event-card {
            background: #f1f1f1;
            padding: 8px;
            border-radius: 6px;
            font-size: 14px;
        }
        .event-time {
            font-weight: bold;
            color: #555;
        }

        /* –ü–æ–ø–∞–ø */
        .mapboxgl-popup {
            max-width: 350px !important;
            font-family: 'Arial', sans-serif;
        }
        .mapboxgl-popup-content {
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 3px 14px rgba(0,0,0,0.4);
            background: #2d2d2d;
            color: white;
        }
        .mapboxgl-popup-content h3 {
            margin: 0 0 10px 0;
            color: #ff6b6b;
            font-size: 18px;
            border-bottom: 1px solid #444;
            padding-bottom: 8px;
        }
        .war-info-table {
            width: 100%;
            font-size: 14px;
            border-collapse: collapse;
        }
        .war-info-table td {
            padding: 6px 0;
            border-bottom: 1px solid #3a3a3a;
        }
        .war-info-table tr:last-child td {
            border-bottom: none;
        }
        .war-info-table td:first-child {
            color: #aaa;
            width: 40%;
        }
    </style>
</head>
<body>

<!-- –ö–∞–ª–µ–Ω–¥–∞—Ä–∏–∫ -->
<div id="date-panel">
    <button class="date-button" id="prev">&lt;</button>
    <span id="current-date"></span>
    <button class="date-button" id="next">&gt;</button>
</div>

<!-- –ö–æ–ª–æ–∫–æ–ª—å—á–∏–∫ -->
<div id="notifications">üîî</div>
<div id="notifications-panel"></div>

<!-- –ö–∞—Ä—Ç–∞ -->
<div id="map"></div>

<script>
const map = new maplibregl.Map({
    container: 'map',
    style: 'https://api.maptiler.com/maps/01966ded-9a2b-7a36-bad5-71bc7e8b2bf7/style.json?key=A7YSMrQ3OZ0oStEWILkD',
    center: [31.1656, 48.3794],
    zoom: 6
});

// ID –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤
const idToName = {
    "80c27733-0eea-4845-93f5-e8938d4a79b3": "–ö—Ä—ã–º",
    "5cdb851b-4447-41b6-ae6f-a134e8b00236": "–õ–î–ù–†"
};

// ID —Å–µ—Ä—ã—Ö "–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö"
const unknownIds = [
    "c23197d4-9c04-4c88-831c-98ca30f6b716",
    "1cb055fe-e90a-4dfe-883a-eba21d440659",
    "fc58ba17-3dae-4bbc-9d5f-c62c3ed676ac"
];

// ID –∫—Ä–∞—Å–Ω—ã—Ö "–æ–∫–∫—É–ø–∏—Ä–æ–≤–∞–Ω–æ"
const occupiedIds = [
    "2228d511-c4fe-488a-a4b6-19e8f8163b01",
    "c94f60ce-f725-41fd-9fee-59d528f59a2a",
    "c682ae45-c0f3-4966-ac2e-7d53534ab54a",
    "18ed4fb6-c145-478f-baee-efa28b2601a5",
    "2e1aacf8-b288-4067-8373-a6afecc8debe",
    "4a635846-b315-4ef6-ba1e-728b5eb76d98",
    "5885a5c6-9b23-4e22-8e42-d1edf8f3b301",
    "c8b24166-6bee-480d-ab52-e5fcfbc9e28b",
    "a62ed399-6dab-4593-a845-2eea4c20d798",
    "14f624ef-2e2d-4f1a-9c2a-32e252fdbfeb",
    "2cdb7a21-da5a-4393-8972-91c4b30739a4",
    "64ce2e6f-00fc-4193-a4e9-6a76b2a03021",
    "38be1fbf-fcb2-422e-a4e5-96010a2dc6e2",
    "bb33f55a-d29e-4481-ba04-80df46de0115",
    "22b8b8e8-394b-4625-b388-19cbdd597de5",
    "62147c99-fe66-40f2-b4df-34621ed6d853",
    "a74cd8d9-0994-4fab-82e7-14146f3a5d9a",
    "470acd07-1405-496e-87f4-314f0f3b1ef2",
    "5bf99d3e-af7a-460e-a9e8-5965c7e86959",
    "1d234475-4fd9-466b-9f69-4e59e02ba756",
    "c7bf8dae-1b72-48f4-aa51-d62e31f32268",
    "7a7efc17-c569-46e0-8ad9-3acea3152f2e",
    "747b8f95-8c3d-40b3-a806-a2a3ea96f78f"
    
];

// –î–æ—Å—Ç—É–ø–Ω—ã–µ –¥–∞—Ç—ã –∏ –≤—Ä–µ–º–µ–Ω–∞
const availableDates = [
    "2022-02-23_00-00",
    "2022-02-24_04-00",
    "2022-02-24_09-00",
    "2022-02-24_13-00",
    "2022-02-24_19-00",
    "2022-02-24_23-00",
    "2022-02-25_10-00",
    "2022-02-25_15-00",
    "2022-02-25_23-00",
    "2022-02-26_10-00",
    "2022-02-27_10-00",
    "2022-02-28_12-00"
];

const liberatedIds = [
    "12e41b8c-34ae-4cc6-9fc2-a7e570d762be"
];


// –°–æ–±—ã—Ç–∏—è
const events = {
    "2022-02-24": [
        { time: "09:00", text: "–í—Ä–∞–≥ –ø—Ä–æ–¥–≤–∏–Ω—É–ª—Å—è –∫ –≥–æ—Ä–æ–¥—É X" },
        { time: "04:00", text: "–ù–∞—á–∞–ª–æ—Å—å –Ω–∞—Å—Ç—É–ø–ª–µ–Ω–∏–µ –≤ —Ä–∞–π–æ–Ω–µ Y" }
    ]
};

let currentIndex = 0;

function formatArea(area) {
    return (area / 1000000).toFixed(2).replace(/\B(?=(\d{3})+(?!\d))/g, ' ') + ' –∫–º¬≤';
}

async function loadMap(dateStr) {
    const url = `https://vleddd.github.io/DeepYouMap/maps/map_${dateStr}.geojson`;
    try {
        const response = await fetch(url);
        const geojson = await response.json();

        geojson.features.forEach(feature => {
            const featureId = feature.id || feature.properties.id || feature.properties.featureId;
            if (idToName[featureId]) {
            feature.properties.customName = idToName[featureId];
            feature.properties.fillColor = "#b57edc"; // —Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π
            } else if (occupiedIds.includes(featureId)) {
            feature.properties.customName = "–û–∫–∫—É–ø–∏—Ä–æ–≤–∞–Ω–æ";
            feature.properties.fillColor = "#d22b2b"; // –∫—Ä–∞—Å–Ω—ã–π
            } else if (liberatedIds.includes(featureId)) {
            feature.properties.customName = "–û—Å–≤–æ–±–æ–∂–¥–µ–Ω–æ";
            feature.properties.fillColor = "#3498db"; // —Å–∏–Ω–∏–π
            } else if (unknownIds.includes(featureId)) {
            feature.properties.customName = "(–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ)";
            feature.properties.fillColor = "#777777"; // —Å–µ—Ä—ã–π
            } else {
            feature.properties.customName = "(–Ω–µ–∏–∑–≤–µ—Å—Ç–Ω–æ)";
            feature.properties.fillColor = "#777777";
            }

            feature.properties.areaFormatted = formatArea(turf.area(feature));
        });

        if (map.getSource('war-zones')) {
            map.getSource('war-zones').setData(geojson);
        } else {
            map.addSource('war-zones', { type: 'geojson', data: geojson });

            map.addLayer({
                id: 'war-polygons',
                type: 'fill',
                source: 'war-zones',
                paint: {
                    'fill-color': ['get', 'fillColor'],
                    'fill-opacity': 0.5,
                    'fill-outline-color': '#a31212'
                },
                filter: ['==', '$type', 'Polygon']
            });

            map.on('click', 'war-polygons', (e) => {
                const feature = e.features[0];
                const popupHTML = `
                    <h3>${feature.properties.customName}</h3>
                    <table class="war-info-table">
                        <tr><td>–ü–ª–æ—â–∞–¥—å:</td><td>${feature.properties.areaFormatted}</td></tr>
                    </table>
                `;
                new maplibregl.Popup()
                    .setLngLat(e.lngLat)
                    .setHTML(popupHTML)
                    .addTo(map);
            });

            map.on('mouseenter', 'war-polygons', () => {
                map.getCanvas().style.cursor = 'pointer';
            });
            map.on('mouseleave', 'war-polygons', () => {
                map.getCanvas().style.cursor = '';
            });
        }
    } catch (error) {
        console.error("–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ä—Ç—ã:", error);
    }
}

function updateDatePanel() {
    const [datePart, timePart] = availableDates[currentIndex].split('_');
    document.getElementById('current-date').textContent = `${datePart} ${timePart.replace('-', ':')}`;
    loadMap(availableDates[currentIndex]);
    loadEvents(datePart);
}

function loadEvents(date) {
    const panel = document.getElementById('notifications-panel');
    panel.innerHTML = '';
    if (events[date]) {
        const sorted = [...events[date]].sort((a, b) => b.time.localeCompare(a.time));
        for (const ev of sorted) {
            const div = document.createElement('div');
            div.className = 'event-card';
            div.innerHTML = `<div class="event-time">${ev.time}</div><div>${ev.text}</div>`;
            panel.appendChild(div);
        }
    } else {
        panel.innerHTML = '<div>–ù–µ—Ç —Å–æ–±—ã—Ç–∏–π –Ω–∞ —ç—Ç—É –¥–∞—Ç—É</div>';
    }
}

document.getElementById('prev').onclick = () => {
    if (currentIndex > 0) {
        currentIndex--;
        updateDatePanel();
    }
};
document.getElementById('next').onclick = () => {
    if (currentIndex < availableDates.length - 1) {
        currentIndex++;
        updateDatePanel();
    }
};

document.getElementById('notifications').onclick = () => {
    const panel = document.getElementById('notifications-panel');
    panel.style.display = panel.style.display === 'flex' ? 'none' : 'flex';
};

map.on('load', () => {
    updateDatePanel();
});

// –ê–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–∞—Ä—Ç—ã
setInterval(() => {
    updateDatePanel();
}, 10000);

</script>

</body>
</html>
